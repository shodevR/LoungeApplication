<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="VoucherList.css">
    <link rel="stylesheet" href="create-voucher.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid row p-0 m-0" style="height: 100vh;">

    <div class="col-lg-3 VoucherListLeft">

        <div class="BBLlogoContainer">
            <img src="images/login/BBL.png" alt="">
        </div>

        <div class="voucherListButtons">
            <ul class="nav nav-tabs tabContainer1" id="myTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a href="/voucherlist">
                        <button class="nav-link custom-tab active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1" aria-selected="true">
                            <div class="tab-content-center">
                                <img src="/images/VoucherList/VOUCHERMAIN.png" alt="" class="tab-icon">
                                <span class="tab-text">Voucher</span>
                            </div>
                        </button>
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a href="/voucherlist">
                        <button class="nav-link custom-tab" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab" aria-controls="tab2" aria-selected="false">
                            <div class="tab-content-center">
                                <img src="/images/VoucherList/PackagesIcon.png" alt="" class="tab-icon">
                                <span class="tab-text">Packages</span>
                            </div>
                        </button>
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a href="/voucherlist">
                        <button class="nav-link custom-tab" id="tab3-tab" data-bs-toggle="tab" data-bs-target="#tab3" type="button" role="tab" aria-controls="tab3" aria-selected="false">
                            <div class="tab-content-center">
                                <img src="/images/VoucherList/FootfallIcon.png" alt="" class="tab-icon">
                                <span class="tab-text">Footfall</span>
                            </div>
                        </button>
                    </a>
                </li>

                <li class="nav-item" role="presentation">
                    <a href="/voucherlist">
                        <button class="nav-link custom-tab" id="tab4-tab" data-bs-toggle="tab" data-bs-target="#tab4" type="button" role="tab" aria-controls="tab4" aria-selected="false">
                            <div class="tab-content-center">
                                <img src="/images/VoucherList/Partner.png" alt="" class="tab-icon">
                                <span class="tab-text">Partner</span>
                            </div>
                        </button>
                    </a>
                </li>
            </ul>
        </div>

        <button class="logoutBtn">

            <img src="/images/VoucherList/LogoutIcon.png" alt="" class="tab-icon">
            <span class="tab-text">LogOut</span>

        </button>

    </div>

    <div class="col-lg-9 p-0">

        <div class="container-fluid p-0 m-0">
            <div class="voucherListHeader container-fluid">
                <p>+ Create Package</p>
            </div>
        </div>
        <div class="container-fluid voucherListParent" id="addVoucherForm">
            <p class="text-danger p-4">All Fields are mandatory *</p>
            <div class="packageInputBoxContainers1 mt-3">
                <input type="text" placeholder="Package Name">
                <input type="text" placeholder="Hour Access">
                <select class="arrowspace">
                    <option value="select">No. of Time Access</option>
                    <option value="multiple">Multiple</option>
                    <option value="single">Single</option>
                </select>
            </div>

            <div class="packageInputBoxContainers1">
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                <button onclick="chooseImage()" class="createPackageImage">Add Image</button>
                <button onclick="uploadImage()"  class="createPackageImageBtn">Save</button>
                <p id="uploadMessage"></p>
            </div>


            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/Harddrink.png" alt="">
                    <p>Hard Drinks</p>
                </div>
                <input type="text" id="hardDrinksInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="hardDrinksUnlimited" onchange="toggleInput('hardDrinksInput', this)">
                <label for="hardDrinksUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/SoftDrink.png" alt="">
                    <p>Soft Drinks</p>
                </div>
                <input type="text" id="softDrinksInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="softDrinksUnlimited" onchange="toggleInput('softDrinksInput', this)">
                <label for="softDrinksUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/breakfast.png" alt="">
                    <p>Breakfast</p>
                </div>
                <input type="text" id="breakfastInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="breakfastUnlimited" onchange="toggleInput('breakfastInput', this)">
                <label for="breakfastUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/Lunch.png" alt="">
                    <p>Lunch</p>
                </div>
                <input type="text" id="lunchInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="lunchUnlimited" onchange="toggleInput('lunchInput', this)">
                <label for="lunchUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/Dinner.png" alt="">
                    <p>Dinner</p>
                </div>
                <input type="text" id="dinnerInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="dinnerUnlimited" onchange="toggleInput('dinnerInput', this)">
                <label for="dinnerUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/Snacks.png" alt="">
                    <p>snacks</p>
                </div>
                <input type="text" id="snacksInput" placeholder="Add here" class="packageMealInput">
                <input type="checkbox" id="snacksUnlimited" onchange="toggleInput('snacksInput', this)">
                <label for="snacksUnlimited" class="UnlimitedCheckboxLabel">Unlimited</label>
            </div>

            <div class="packageMealOptions">
                <div class="packagemealbox">
                    <img src="images/packageIcons/wifi.png" alt="">
                    <p>WiFi</p>
                </div>
                <input type="checkbox" id="wifiIncluded" name="wifi" value="Included" class="UnlimitedCheckbox">
                <label for="wifiIncluded" class="includeBox">Included</label>
                <input type="checkbox" id="wifiNotIncluded" name="wifi" value="Not-Included" class="UnlimitedCheckbox">
                <label for="wifiNotIncluded" class="includeBox">Not-Included</label>
            </div>

            <div class="packageInputBoxContainers1">
                <input type="text" placeholder="Amount">
            </div>

            <div class="buttonContainer">
                <button class="savebtn" onclick="saveAndList()">
                    Save & List
                </button>
            </div>
        </div>

    </div>
</div>
</body>
<script>
    var img ="";
    function chooseImage() {
        document.getElementById('imageInput').click();
    }

    // Function to handle image upload
    function uploadImage() {
        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
        console.log(csrfToken);
        console.log(csrfHeader);

        if (!csrfToken || !csrfHeader) {
            console.error('CSRF token or header name not found');
            alert('CSRF token or header name not found. Please check your HTML.');
            return;
        }

        const fileInput = document.getElementById('imageInput');
        const file = fileInput.files[0];

        if (!file) {
            alert('Please select an image.');
            return;
        }

        const formData = new FormData();
        formData.append('file', file);

        fetch('/api/file/upload', {
            method: 'POST',
            body: formData,
            headers: {
                [csrfHeader]: csrfToken
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to upload image');
                }
                return response.text();
            })
            .then(data => {
                console.log(data);
                img = data;

                document.getElementById('uploadMessage').innerText = 'Image uploaded successfully.';
            })
            .catch(error => {
                console.error('Error uploading image:', error);
            });
    }

    // Function to trigger file input click
    function chooseImage() {
        document.getElementById('imageInput').click();
    }

    // Function to toggle input field based on checkbox state
    function toggleInput(inputId, checkbox) {
        var inputField = document.getElementById(inputId);
        inputField.disabled = checkbox.checked;
        if (checkbox.checked) {
            inputField.value = ""; // Clear the input value if checkbox is checked
        }
    }

    // Function to get values and log to console
    function saveAndList() {
        // Get CSRF token from meta tag
        const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
        console.log(csrfToken);
        console.log(csrfHeader);

        // Ensure CSRF token and header name are retrieved correctly
        if (!csrfToken || !csrfHeader) {
            console.error('CSRF token or header name not found');
            alert('CSRF token or header name not found. Please check your HTML.');
            return;
        }

        // Get values from input fields
        var packageName = document.querySelector('input[placeholder="Package Name"]').value;
        var hourAccess = document.querySelector('input[placeholder="Hour Access"]').value;
        var timeAccess = document.querySelector('select').value;

        // Get values from package meal options
        var hardDrinksValue = document.querySelector('#hardDrinksInput').value;
        var hardDrinksUnlimited = document.querySelector('#hardDrinksUnlimited').checked;
        var softDrinksValue = document.querySelector('#softDrinksInput').value;
        var softDrinksUnlimited = document.querySelector('#softDrinksUnlimited').checked;
        var breakfastValue = document.querySelector('#breakfastInput').value;
        var breakfastUnlimited = document.querySelector('#breakfastUnlimited').checked;
        var lunchValue = document.querySelector('#lunchInput').value;
        var lunchUnlimited = document.querySelector('#lunchUnlimited').checked;
        var dinnerValue = document.querySelector('#dinnerInput').value;
        var dinnerUnlimited = document.querySelector('#dinnerUnlimited').checked;
        var snacksValue = document.querySelector('#snacksInput').value;
        var snacksUnlimited = document.querySelector('#snacksUnlimited').checked;
        var wifiIncluded = document.querySelector('#wifiIncluded').checked;
        var wifiNotIncluded = document.querySelector('#wifiNotIncluded').checked;
        var amountValue = document.querySelector('.packageInputBoxContainers1 input[placeholder="Amount"]').value;

        // Create payload object to send to API
        var payload = {
            packageName: packageName,
            hour: hourAccess,
            times: timeAccess,
            drinks: hardDrinksUnlimited ? "unlimited" : hardDrinksValue,
            softDrink: softDrinksUnlimited ? "unlimited" : softDrinksValue,
            breakfast: breakfastUnlimited ? "unlimited" : breakfastValue,
            lunch: lunchUnlimited ? "unlimited" : lunchValue,
            Dinner: dinnerUnlimited ? "unlimited" : dinnerValue,
            snack: snacksUnlimited ? "unlimited" : snacksValue,
            wifi: wifiIncluded,
            image: img,
            amount: amountValue,
            flag: true // You need to decide how to handle this, as it's not clear from the form
        };
        console.log(payload);

        // Make a POST request to your API
        fetch('/api/packages/addPackage', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                [csrfHeader]: csrfToken // Add CSRF header
            },
            body: JSON.stringify(payload)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add package');
                }
                return response.json();
            })
            .then(data => {
                // Display alert message with the package ID
                alert('Package has been saved with package ID: ' + data.packageId);
                // Reset the form after successful save
                resetForm();
            })
            .catch(error => {
                console.error('Error adding package:', error);
                // Handle error, if needed
            });
    }

    // Function to trigger file input click


    function resetForm() {
        // Reset input fields
        document.querySelector('input[placeholder="Package Name"]').value = "";
        document.querySelector('input[placeholder="Hour Access"]').value = "";
        document.querySelector('select').value = "select";
        document.querySelector('#hardDrinksInput').value = "";
        document.querySelector('#hardDrinksUnlimited').checked = false;
        document.querySelector('#softDrinksInput').value = "";
        document.querySelector('#softDrinksUnlimited').checked = false;
        document.querySelector('#breakfastInput').value = "";
        document.querySelector('#breakfastUnlimited').checked = false;
        document.querySelector('#lunchInput').value = "";
        document.querySelector('#lunchUnlimited').checked = false;
        document.querySelector('#dinnerInput').value = "";
        document.querySelector('#dinnerUnlimited').checked = false;
        document.querySelector('#snacksInput').value = "";
        document.querySelector('#snacksUnlimited').checked = false;
        document.querySelector('#wifiIncluded').checked = false;
        document.querySelector('#wifiNotIncluded').checked = false;
        document.querySelector('.packageInputBoxContainers1 input[placeholder="Amount"]').value = "";
    }
</script>

</body>
</html>

